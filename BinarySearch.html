<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Binary Hunter: Search Protocol</title>
    <style>
        :root {
            --bg: #0b1120;
            --cyan: #06b6d4;
            --cyan-dim: #0e7490;
            --dark: #164e63;
            --text: #ecfeff;
            --disabled: #334155;
            --font-tech: 'Courier New', Courier, monospace;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: var(--font-tech);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            user-select: none;
        }

        h1 {
            text-shadow: 0 0 10px var(--cyan);
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .hud {
            display: flex;
            gap: 40px;
            margin-bottom: 30px;
            font-size: 1.2rem;
            border: 1px solid var(--cyan-dim);
            padding: 15px 30px;
            background: rgba(6, 182, 212, 0.05);
            border-radius: 4px;
        }

        .target-box {
            font-weight: bold;
            color: var(--cyan);
            font-size: 1.5rem;
        }

        #game-board {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            max-width: 900px;
            padding: 20px;
        }

        .node {
            width: 50px;
            height: 50px;
            border: 1px solid var(--cyan-dim);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: bold;
            background: rgba(14, 116, 144, 0.1);
            position: relative;
        }

        .node:hover:not(.disabled) {
            background: var(--cyan);
            color: #000;
            box-shadow: 0 0 15px var(--cyan);
            transform: scale(1.1);
            z-index: 10;
        }

        .node.disabled {
            opacity: 0.2;
            border-color: var(--disabled);
            cursor: not-allowed;
            background: transparent;
        }

        .node.selected {
            background: #fff;
            color: #000;
            border-color: #fff;
        }

        .node.correct {
            background: #22c55e; /* Green */
            border-color: #22c55e;
            box-shadow: 0 0 20px #22c55e;
            color: white;
            animation: pulse 1s infinite;
        }

        /* Highlight gợi ý vị trí Mid */
        .node.suggested {
            border: 2px dashed #fbbf24; /* Amber */
            color: #fbbf24;
            box-shadow: 0 0 10px #fbbf24;
        }
        .node.suggested::after {
            content: 'MID';
            position: absolute;
            top: -20px;
            font-size: 0.6rem;
            color: #fbbf24;
            font-weight: bold;
        }

        /* Đánh dấu phạm vi tìm kiếm */
        .node.range-bound {
            border-color: #fff;
        }

        .msg-area {
            height: 30px;
            margin-top: 20px;
            color: var(--cyan);
            font-weight: bold;
        }

        .btn {
            margin-top: 30px;
            padding: 12px 30px;
            background: transparent;
            border: 1px solid var(--cyan);
            color: var(--cyan);
            font-family: var(--font-tech);
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            text-transform: uppercase;
        }

        .btn:hover {
            background: var(--cyan);
            color: #000;
            box-shadow: 0 0 20px var(--cyan);
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>

    <h1>BINARY HUNTER</h1>
    
    <div class="hud">
        <div>MỤC TIÊU: <span id="target-val" class="target-box">?</span></div>
        <div>SCAN CÒN LẠI: <span id="moves-left" style="color: #f43f5e">0</span></div>
    </div>

    <div id="game-board"></div>
    <div id="message" class="msg-area">Hệ thống sẵn sàng...</div>

    <button class="btn" onclick="initGame()">KHỞI ĐỘNG LẠI</button>

    <script>
        // Cấu hình game
        const ARRAY_SIZE = 31; // 31 phần tử => log2(31) ~ 5 bước
        let array = [];
        let target = 0;
        let moves = 0;
        let isPlaying = false;
        let low = 0;
        let high = ARRAY_SIZE - 1;
        let mid = 0;

        // Audio Context
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);

            const now = audioCtx.currentTime;
            if (type === 'hover') {
                osc.frequency.setValueAtTime(400, now);
                gain.gain.setValueAtTime(0.05, now);
                osc.start();
                osc.stop(now + 0.05);
            } else if (type === 'scan') {
                osc.type = 'square';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.exponentialRampToValueAtTime(200, now + 0.1);
                gain.gain.setValueAtTime(0.1, now);
                osc.start();
                osc.stop(now + 0.1);
            } else if (type === 'win') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(440, now);
                osc.frequency.setValueAtTime(880, now + 0.2);
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.linearRampToValueAtTime(0, now + 1);
                osc.start();
                osc.stop(now + 1);
            } else if (type === 'error') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(100, now);
                gain.gain.setValueAtTime(0.2, now);
                gain.gain.linearRampToValueAtTime(0, now + 0.3);
                osc.start();
                osc.stop(now + 0.3);
            }
        }

        function initGame() {
            // 1. Tạo mảng đã sắp xếp
            array = [];
            let current = Math.floor(Math.random() * 10) + 1;
            for(let i=0; i<ARRAY_SIZE; i++) {
                array.push(current);
                current += Math.floor(Math.random() * 5) + 1; // Tăng dần
            }

            // 2. Chọn mục tiêu ngẫu nhiên
            const targetIndex = Math.floor(Math.random() * ARRAY_SIZE);
            target = array[targetIndex];

            // 3. Reset trạng thái
            low = 0;
            high = ARRAY_SIZE - 1;
            moves = Math.ceil(Math.log2(ARRAY_SIZE)); // 5 bước cho 31 phần tử
            isPlaying = true;

            // 4. Cập nhật UI
            document.getElementById('target-val').innerText = target;
            document.getElementById('moves-left').innerText = moves;
            document.getElementById('message').innerText = "Hãy chọn ô có chữ 'MID' (Vị trí giữa)...";
            document.getElementById('message').style.color = "var(--cyan)";
            
            renderBoard();
            updateVisuals();
        }

        function renderBoard() {
            const board = document.getElementById('game-board');
            board.innerHTML = '';

            array.forEach((val, idx) => {
                const node = document.createElement('div');
                node.className = 'node';
                node.innerText = val;
                node.dataset.index = idx;

                // Hiệu ứng disable các vùng đã bị loại bỏ
                if (idx < low || idx > high) {
                    node.classList.add('disabled');
                }

                node.onmouseenter = () => { if(isPlaying && !node.classList.contains('disabled')) playSound('hover'); };
                node.onclick = () => handleScan(idx);
                
                board.appendChild(node);
            });
        }

        function updateVisuals() {
            if (!isPlaying) return;
            
            // Xóa các class cũ
            document.querySelectorAll('.node').forEach(n => {
                n.classList.remove('suggested', 'range-bound');
            });

            // Tính toán vị trí giữa theo công thức Binary Search
            mid = Math.floor((low + high) / 2);

            const nodes = document.querySelectorAll('.node');
            if(nodes[low]) nodes[low].classList.add('range-bound');
            if(nodes[high]) nodes[high].classList.add('range-bound');
            if(nodes[mid]) nodes[mid].classList.add('suggested');
        }

        function handleScan(idx) {
            if (!isPlaying) return;
            if (idx < low || idx > high) {
                playSound('error');
                showMessage("Khu vực này đã bị loại bỏ! Hãy tập trung vào vùng sáng.", "#f43f5e");
                return;
            }

            // Cảnh báo nếu không chọn đúng thuật toán (không bắt buộc nhưng nhắc nhở)
            if (idx !== mid) {
                showMessage("Cảnh báo: Đây không phải vị trí GIỮA (Mid). Hiệu quả tìm kiếm thấp!", "#fbbf24");
                // Vẫn cho phép chơi tiếp nhưng cảnh báo
            }

            playSound('scan');
            moves--;
            document.getElementById('moves-left').innerText = moves;

            const val = array[idx];
            const nodes = document.querySelectorAll('.node');
            
            // Highlight node vừa chọn
            nodes[idx].classList.add('selected');

            if (val === target) {
                // Chiến thắng
                endGame(true, idx);
            } else {
                // Logic Binary Search
                if (val < target) {
                    // Mục tiêu lớn hơn -> Bỏ phần bên trái
                    low = idx + 1;
                    showMessage(`Giá trị ${val} < Mục tiêu. Loại bỏ phía bên trái.`, "#fbbf24");
                } else {
                    // Mục tiêu nhỏ hơn -> Bỏ phần bên phải
                    high = idx - 1;
                    showMessage(`Giá trị ${val} > Mục tiêu. Loại bỏ phía bên phải.`, "#fbbf24");
                }

                // Render lại để làm mờ vùng bị loại
                setTimeout(() => {
                    renderBoard();
                    updateVisuals(); // Cập nhật lại vị trí Mid mới
                }, 300);

                // Kiểm tra thua
                if (moves <= 0) {
                    endGame(false);
                }
            }
        }

        function endGame(isWin, idx) {
            isPlaying = false;
            if (isWin) {
                playSound('win');
                document.querySelectorAll('.node')[idx].classList.add('correct');
                showMessage("MỤC TIÊU ĐÃ ĐƯỢC TÌM THẤY! NHIỆM VỤ HOÀN THÀNH.", "#22c55e");
            } else {
                playSound('error');
                showMessage("HẾT LƯỢT QUÉT! NHIỆM VỤ THẤT BẠI.", "#f43f5e");
            }
        }

        function showMessage(msg, color) {
            const m = document.getElementById('message');
            m.innerText = msg;
            m.style.color = color;
        }

        window.onload = initGame;
    </script>
</body>
</html>